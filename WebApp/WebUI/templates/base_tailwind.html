<!DOCTYPE html>
<html lang="en">
    {% load static %}
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Dashboard - NiceAdmin Bootstrap Template</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="{% static 'assets/img/favicon.png' %}" rel="icon">
    <link href="{% static 'assets/img/apple-touch-icon.png' %}" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  
    <!-- Vendor CSS Files -->
  <link href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/boxicons/css/boxicons.min.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/quill/quill.snow.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/quill/quill.bubble.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/remixicon/remixicon.css' %}" rel="stylesheet">
  <link href="{% static 'assets/vendor/simple-datatables/style.css' %}" rel="stylesheet">
  <!-- Template Main CSS File -->
<link href="{% static 'assets/css/style.css' %}" rel="stylesheet">

 <!--jquery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<!--Tagify -->
<script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
<script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.polyfills.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css" />




<style>
  iframe {
  width: 100%;
  height: 100%;
      }
  .chatbotWindow {
  position: fixed;
  width: 28vw;
  height: 53vh;
  bottom: 700px;
  right: 200px;
  }
  .window {
  position: fixed;
  width: 50vw;
  height: 55vh;
  bottom: 10px !important;
  right: 10px !important;
  border-radius: 10px;
  border: none;
  box-shadow: 1px 1px 4px rgba(0,0,0,0,0.9), -1px 1px 4px rgba(0,0,0,0,0.9);
  background: #00000000;
  z-index: 9999999;
}

.window-content {
  background: #00000000;
  color: #fff;
  height: 100%;
  font-family: monospace;
  padding: 5px;
  overflow-y: auto;
}

.window-top, .window-top-no-bind {
  cursor: move;
  text-align: right;
  height: 30px;
  border-bottom: 1px solid rgba(0,0,0,0.5);
  border-top-right-radius: 5px;
  border-top-left-radius: 5px;
  padding: 5px;
  background-color: #ddd;
}

.window-top-no-bind {
  cursor: inherit;
}

.round {
  height: 16px;
  width: 16px;
  border-radius: 50%;
  border: none;
  margin-right: 6px;
  box-shadow: 1px 1px 2px #000;
}

.green {
  background-color: limegreen;
}

.yellow {
  background-color: yellow;
}

.red {
  cursor: pointer;
  background-color: red;
}

.blue {
  cursor : pointer;
  background-color: blue;
}

</style>
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    
    <div class="d-flex align-items-center justify-content-between">
      <a href="{% url 'wip' %}" class="logo d-flex align-items-center">
        <img src="{% static 'assets/img/logo.png' %}" alt="">
        <span class="d-none d-lg-block">ABKMS</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->

    <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form>
    </div><!-- End Search Bar -->

    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">

        <li class="nav-item d-block d-lg-none">
          <a class="nav-link nav-icon search-bar-toggle " href="#">
            <i class="bi bi-search"></i>
          </a>
        </li><!-- End Search Icon-->



          <a  class="nav-link nav-icon" href="#" id="chatbotTrigger">
            <i class="bi bi-chat-left-text"></i>
          </a><!-- End Chat Icon -->

        <li class="nav-item dropdown pe-3">

          <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
            <img src="https://i1.hdslb.com/bfs/archive/018198fcf0c7dc109d466895527e8d8c6686a297.jpg@600w_600h_1c.png" alt="Profile" class="rounded-circle">
            <span class="d-none d-md-block dropdown-toggle ps-2">Kurros LAN</span>
          </a><!-- End Profile Iamge Icon -->

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
            <li class="dropdown-header">
              <h6>Kevin Anderson</h6>
              <span>Web Designer</span>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                <i class="bi bi-person"></i>
                <span>My Profile</span>
              </a>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                <i class="bi bi-gear"></i>
                <span>Account Settings</span>
              </a>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="pages-faq.html">
                <i class="bi bi-question-circle"></i>
                <span>Need Help?</span>
              </a>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="#">
                <i class="bi bi-box-arrow-right"></i>
                <span>Sign Out</span>
              </a>
            </li>

          </ul><!-- End Profile Dropdown Items -->
        </li><!-- End Profile Nav -->

      </ul>
    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">
      <li class="nav-item">
        <a class="nav-link " href="{%url 'wip' %}">
          <i class="bi bi-grid"></i>
          <span>Dashboard</span>
        </a>
      </li><!-- End Dashboard Nav -->

      <li class="nav-item">
        
          
        <a class="nav-link collapsed" data-bs-target="#components-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Documents</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="components-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="{% url 'document_upload' %}" class="ajax-nav-link" data-url="{% url 'document_upload' %}">
              <i class="bi bi-circle"></i><span>Upload</span>
            </a>            
          </li>
          <li>
            <a href="{% url 'document_viewer' %}" class="ajax-nav-link" data-url="{% url 'document_viewer' %}">
              <i class="bi bi-circle"></i><span>Viewer</span>
            </a>
          </li>
          <li>
            <a href="{% url 'document_manager' %}" class="ajax-nav-link" data-url="{% url 'document_manager' %}">
              <i class="bi bi-circle"></i><span>Manager(WIP)</span>
            </a>
          </li>
          <li>
            <a href="{% url 'search' %}" class="ajax-nav-link" data-url="{% url 'search' %}">
              <i class="bi bi-circle"></i><span>Search</span>
            </a>
          </li>
        </ul>
      </li><!-- End Components Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#forms-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-journal-text"></i><span>Chat</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="forms-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="{% url 'chat' %}" class="ajax-nav-link" data-url="{% url 'chat' %}">
              <i class="bi bi-circle"></i><span>Chat with database</span>
            </a>
          </li>
          <li>
            <a href="{% url 'wip' %}" class="ajax-nav-link" data-url="{% url 'wip' %}">
              <i class="bi bi-circle"></i><span>Chat History</span>
            </a>
          </li>
          <li>
            <a href="{%url 'wip' %}">
              <i class="bi bi-circle"></i><span>WIP</span>  
            </a>
          </li>
          <li>
            <a href="{%url 'wip' %}">
              <i class="bi bi-circle"></i><span>WIP</span>
            </a>
          </li>
        </ul>
      </li><!-- End Forms Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#tables-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-layout-text-window-reverse"></i><span>Notes</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="tables-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="{%url 'wip' %}">
              <i class="bi bi-circle"></i><span>Note Taking</span>
            </a>
          </li>
          <li>
            <a href="{%url 'wip' %}">
              <i class="bi bi-circle"></i><span>Knowleage Graph</span>
            </a>
          </li>
        </ul>
      </li><!-- End Tables Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#charts-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-bar-chart"></i><span>Projects</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="charts-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="{%url 'wip' %}">
              <i class="bi bi-circle"></i><span>TO-DO</span>
            </a>
          </li>
          <li>
            <a href="{%url 'wip' %}">
              <i class="bi bi-circle"></i><span>Peronal</span>
            </a>
          </li>
          <li>
            <a href="{%url 'wip' %}">
              <i class="bi bi-circle"></i><span>Others</span>
            </a>
          </li>
        </ul>
      </li><!-- End Charts Nav -->


      <li class="nav-heading">Pages</li>

      <li class="nav-item">
        <a class="nav-link collapsed" href="pages-blank.html">
          <i class="bi bi-file-earmark"></i>
          <span>Blank</span>
        </a>
      </li><!-- End Blank Page Nav -->

    </ul>

  </aside><!-- End Sidebar-->
  <div id="chatbotWindow" width="50vw" height="50vh" class="window" style="display: none;">

    <div class="window-top"  class="window">
      <button class="round blue"></button><button class="round green"></button><button class="round yellow"></button><button class="round red"></button>
    </div>
    <div class="window-content">
        <iframe src="http://194.163.147.140:8501/Chatbot_widget" width="100%" frameborder= "0" class="chatIframe"></iframe>
    </div>
</div>
  <main id="main" class="main">

    <div class="pagetitle">
      <h1>ABKMS Dashboard</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{%url 'wip' %}">Home</a></li>
          <li class="breadcrumb-item active">Dashboard</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section dashboard">
      
      {% block content %}
      <!-- Content will go here -->
      {% endblock %}
      
    </section>

                    </main><!-- End #main -->

                    <!-- ======= Footer ======= -->
                    <footer id="footer" class="footer">
                        <div class="copyright">
                            &copy; Copyright <strong><span>Kurros LAN</span></strong>. All Rights Reserved
                        </div>
                        <div class="credits">
                        </div>
                        
                    </footer><!-- End Footer -->

                    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="{% static 'assets/vendor/apexcharts/apexcharts.min.js' %}"></script>
  <script src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'assets/vendor/chart.js/chart.umd.js' %}"></script>
  <script src="{% static 'assets/vendor/echarts/echarts.min.js' %}"></script>
  <script src="{% static 'assets/vendor/quill/quill.min.js' %}"></script>
  <script src="{% static 'assets/vendor/simple-datatables/simple-datatables.js' %}"></script>
  <script src="{% static 'assets/vendor/tinymce/tinymce.min.js' %}"></script>
  <script src="{% static 'assets/vendor/php-email-form/validate.js' %}'"></script>

  <!-- Template Main JS File -->
  <script src="{% static 'assets/js/main.js' %}"></script>

  <!-- ajax-nav-link : load the page without refreshing --> 
  <script>
  $(document).ready(function() {
    $('.ajax-nav-link').click(function(event) {
      event.preventDefault(); // Prevent default link behavior

      var url = $(this).data('url'); // Get the URL from the data-url attribute

      $.ajax({
        url: url,
        success: function(data) {
          $('#main').html(data); // Update the main content area with the response


        },
        error: function() {
          console.log('Error loading content');
        }
      });
    });
  });
</script>


  <!-- make Chatbot Window draggable -->
  <script>
            function makeDraggable(element) {
              let currentPosX = 0, currentPosY = 0, previousPosX = 0, previousPosY = 0;
              
              const dragElement = element.querySelector('.window-top') || element;

              dragElement.addEventListener('mousedown', dragMouseDown);
              dragElement.addEventListener('touchstart', dragMouseDown); // Add touch support

              function dragMouseDown(e) {
                e.preventDefault(); // Prevent default action
                
                if (e.type === 'touchstart') {
                  previousPosX = e.touches[0].clientX;
                  previousPosY = e.touches[0].clientY;
                } else { // For mousedown
                  previousPosX = e.clientX;
                  previousPosY = e.clientY;
                }
                
                document.addEventListener('mouseup', closeDragElement);
                document.addEventListener('touchend', closeDragElement); // Add touch support
                
                document.addEventListener('mousemove', elementDrag);
                document.addEventListener('touchmove', elementDrag); // Add touch support
              }

              function elementDrag(e) {
                e.preventDefault(); // Prevent default action
                
                if (e.type === 'touchmove') {
                  currentPosX = previousPosX - e.touches[0].clientX;
                  currentPosY = previousPosY - e.touches[0].clientY;
                  previousPosX = e.touches[0].clientX;
                  previousPosY = e.touches[0].clientY;
                } else { // For mousemove
                  currentPosX = previousPosX - e.clientX;
                  currentPosY = previousPosY - e.clientY;
                  previousPosX = e.clientX;
                  previousPosY = e.clientY;
                }
                
                // Set the element's new position
                element.style.top = (element.offsetTop - currentPosY) + 'px';
                element.style.left = (element.offsetLeft - currentPosX) + 'px';
              }

              function closeDragElement() {
                // Stop moving when mouse button is released or touch ends
                document.removeEventListener('mouseup', closeDragElement);
                document.removeEventListener('mousemove', elementDrag);
                document.removeEventListener('touchend', closeDragElement); // Remove touch support
                document.removeEventListener('touchmove', elementDrag); // Remove touch support
              }
            }
            
            
            
            
            makeDraggable(document.querySelector('#chatbotWindow'));

            function isTouchDevice() {
    return 'ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;
}

let isTranslucent = false;

// Function to handle interaction
function handleInteraction(event) {
    let target = event.target;
    while (target != null) {
        if (target.classList && target.classList.contains('round')) {
            // Found a target with the 'round' class, check for specific buttons
            if (target.classList.contains('red')) {
                $('#chatbotWindow').toggle();
            } else if (target.classList.contains('yellow')) {
                const chatWindow = document.getElementById('chatbotWindow');
                chatWindow.style.width = '90vw';
                chatWindow.style.height = '90vh';
                chatWindow.style.display = 'block';
            } else if (target.classList.contains('green')) {
                const chatWindow = document.getElementById('chatbotWindow');
                chatWindow.style.width = '50vw';
                chatWindow.style.height = '50vh';
                chatWindow.style.display = 'block';
            } else if (target.classList.contains('blue')) {
                const chatWindow = document.getElementById('chatbotWindow');
                if (!isTranslucent) {
                    chatWindow.style.opacity = '0.6';
                    isTranslucent = true;
                } else {
                    chatWindow.style.opacity = '1';
                    isTranslucent = false;
                }
            }
            // Prevent handling the same touch as a drag
            event.preventDefault();
            break;
        }
        target = target.parentNode;
    }
}

// Attach event listeners for both touch and mouse interactions
if (isTouchDevice()) {
    document.addEventListener('touchend', handleInteraction, {passive: false});
} else {
    // Mouse events
    document.addEventListener('click', handleInteraction);
    document.addEventListener('mousedown', handleInteraction);
    document.addEventListener('mouseup', handleInteraction); 吗，吧
    // Optional: Consider adding 'mousedown' or 'mouseup' if 'click' isn't sufficient
}

// Note: Adding 'pointerdown' and 'pointerup' could further enhance compatibility with devices that use pointer events
document.addEventListener('pointerdown', handleInteraction, {passive: false});
document.addEventListener('pointerup', handleInteraction, {passive: false});

</script>

  <!-- Chatbot window toggle -->
  <script>
                  $(document).on('click', '#chatbotTrigger', function() {
    $('#chatbotWindow').toggle();
});

  </script>


</body>

</html>